<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Poker My Mind – Preflop Trainer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --bg: #05060a;
        --bg-alt: #10121b;
        --card-bg: #151827;
        --accent: #27c9a8;
        --accent-soft: rgba(39, 201, 168, 0.14);
        --danger: #ff5370;
        --text: #f8f9ff;
        --muted: #a3aec7;
        --border: #26293a;
        --font: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: var(--font);
        background: radial-gradient(circle at top, #14172a, #05060a 55%);
        color: var(--text);
        -webkit-font-smoothing: antialiased;
      }

      .app-shell {
        max-width: 900px;
        margin: 0 auto;
        padding: 1.25rem 1rem 2.5rem;
      }

      @media (min-width: 768px) {
        .app-shell {
          padding: 2rem 1.5rem 3rem;
        }
      }

      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
        margin-bottom: 1.5rem;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .logo {
        width: 40px;
        height: 40px;
        border-radius: 18px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background:
          radial-gradient(circle at 20% 0%, rgba(39, 201, 168, 0.4), transparent 55%),
          radial-gradient(circle at 75% 100%, rgba(114, 137, 252, 0.4), transparent 55%),
          #05060a;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1rem;
        font-weight: 700;
        letter-spacing: -0.04em;
        box-shadow:
          0 0 0 1px rgba(0, 0, 0, 0.6),
          0 18px 35px rgba(0, 0, 0, 0.7);
      }

      .brand-title {
        font-weight: 700;
        letter-spacing: 0.03em;
        text-transform: uppercase;
        font-size: 0.9rem;
        color: var(--muted);
      }

      .brand-name {
        font-size: 1.4rem;
        font-weight: 700;
        letter-spacing: 0.02em;
        text-transform: uppercase;
      }

      .tagline {
        font-size: 0.85rem;
        color: var(--muted);
        margin-top: 0.15rem;
      }

      .nav {
        display: inline-flex;
        background: rgba(8, 10, 20, 0.85);
        border-radius: 999px;
        padding: 0.18rem;
        border: 1px solid rgba(255, 255, 255, 0.06);
        box-shadow: 0 12px 25px rgba(0, 0, 0, 0.55);
      }

      .nav button {
        border: none;
        background: transparent;
        color: var(--muted);
        padding: 0.35rem 0.9rem;
        border-radius: 999px;
        font-size: 0.8rem;
        font-weight: 600;
        letter-spacing: 0.04em;
        text-transform: uppercase;
        cursor: pointer;
        transition: all 0.18s ease-out;
        display: flex;
        align-items: center;
        gap: 0.25rem;
        white-space: nowrap;
      }

      .nav button.active {
        background: linear-gradient(135deg, var(--accent), #58d1ff);
        color: #05060a;
        box-shadow: 0 6px 18px rgba(39, 201, 168, 0.45);
      }

      main {
        display: grid;
        gap: 1rem;
      }

      .card {
        background: linear-gradient(145deg, rgba(18, 20, 36, 0.98), rgba(6, 8, 16, 0.98));
        border-radius: 20px;
        padding: 1rem;
        border: 1px solid var(--border);
        box-shadow:
          0 18px 40px rgba(0, 0, 0, 0.7),
          0 0 0 1px rgba(255, 255, 255, 0.02);
      }

      @media (min-width: 768px) {
        .card {
          padding: 1.25rem 1.4rem;
        }
      }

      /* ---------- Preflop layout (wireframe-aligned) ---------- */
      .preflop-layout {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .preflop-scenario-bar {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
        gap: 0.8rem;
        padding: 0.65rem 0.75rem;
        border-radius: 14px;
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid var(--border);
      }

      .scenario-main {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
        min-width: 0;
      }

      .scenario-row {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        flex-wrap: wrap;
      }

      .scenario-label {
        font-size: 0.78rem;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        color: var(--muted);
        font-weight: 600;
      }

      .scenario-controls {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 0.25rem;
        margin-left: auto;
      }

      @media (max-width: 480px) {
        .scenario-controls {
          align-items: flex-start;
        }
      }

      .section-label {
        font-size: 0.78rem;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        color: var(--muted);
        font-weight: 600;
        margin-bottom: 0.35rem;
      }

      .preflop-top {
        display: grid;
        gap: 1rem;
      }

      @media (min-width: 640px) {
        .preflop-top {
          grid-template-columns: minmax(0, 1.15fr) minmax(0, 1fr);
          align-items: stretch;
        }
      }

      .preflop-dealt-cards,
      .preflop-position-info {
        padding: 0.8rem 0.9rem;
        border-radius: 16px;
        background: rgba(7, 9, 20, 0.9);
        border: 1px solid var(--border);
      }

      .preflop-dealt-cards .card-strip {
        margin-top: 0.1rem;
      }

      .preflop-position-info .position-panel {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .position-map {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 0.4rem;
      }

      .position-seat {
        font-size: 0.78rem;
        padding: 0.3rem 0.4rem;
        border-radius: 999px;
        border: 1px dashed rgba(255, 255, 255, 0.18);
        text-align: center;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.12em;
      }

      .position-seat.active {
        border-style: solid;
        border-color: var(--accent);
        background: var(--accent-soft);
        color: var(--accent);
      }

      .position-note {
        margin: 0;
      }

      .preflop-actions {
        padding: 0.7rem 0.9rem 0.9rem;
        border-radius: 16px;
        background: rgba(5, 8, 18, 0.9);
        border: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .preflop-actions .actions-row {
        margin-top: 0.15rem;
      }

      .preflop-primary {
        display: flex;
        flex-direction: column;
        gap: 0.4rem;
        align-items: stretch;
      }

      .preflop-feedback {
        margin-top: 0.3rem;
        padding: 0.85rem 0.9rem;
        border-radius: 18px;
        background: rgba(4, 6, 16, 0.95);
        border: 1px solid var(--border);
        display: grid;
        gap: 0.75rem;
      }

      @media (min-width: 768px) {
        .preflop-feedback {
          grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
          align-items: flex-start;
        }
      }

      .preflop-feedback .result,
      .preflop-feedback .stats-card {
        margin-top: 0;
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        gap: 0.5rem;
        margin-bottom: 0.6rem;
      }

      .card-title {
        font-size: 1rem;
        font-weight: 600;
        letter-spacing: 0.04em;
        text-transform: uppercase;
      }

      .card-subtitle {
        font-size: 0.8rem;
        color: var(--muted);
      }

      .pill {
        font-size: 0.7rem;
        padding: 0.2rem 0.6rem;
        border-radius: 999px;
        background: var(--accent-soft);
        color: var(--accent);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-weight: 600;
      }

      .field-group {
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
      }

      label {
        font-size: 0.8rem;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-weight: 600;
      }

      select,
      input[type="number"] {
        width: 100%;
        padding: 0.55rem 0.7rem;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: rgba(6, 8, 16, 0.95);
        color: var(--text);
        font-size: 0.9rem;
        outline: none;
        transition:
          border-color 0.18s ease-out,
          box-shadow 0.18s ease-out,
          background 0.18s ease-out;
        appearance: none;
      }

      select:focus,
      input[type="number"]:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 1px rgba(39, 201, 168, 0.35);
        background: rgba(13, 17, 30, 0.98);
      }

      .hand-row {
        display: flex;
        gap: 0.6rem;
        align-items: center;
        flex-wrap: wrap;
      }

      .hand-preview {
        font-family: "JetBrains Mono", "SF Mono", ui-monospace, monospace;
        font-size: 0.9rem;
        padding: 0.25rem 0.6rem;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.09);
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
      }

      .hand-preview span {
        opacity: 0.7;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.12em;
      }

      .toggle-group {
        display: inline-flex;
        border-radius: 999px;
        border: 1px solid var(--border);
        overflow: hidden;
        background: rgba(3, 5, 11, 0.9);
      }

      .toggle-group button {
        border: none;
        padding: 0.28rem 0.7rem;
        font-size: 0.8rem;
        color: var(--muted);
        background: transparent;
        cursor: pointer;
        transition: all 0.16s ease-out;
      }

      .toggle-group button.active {
        background: var(--accent-soft);
        color: var(--accent);
      }

      .actions-row {
        display: flex;
        gap: 0.4rem;
        flex-wrap: wrap;
      }

      .action-btn {
        flex: 1 0 0;
        min-width: 0;
        padding: 0.5rem 0.6rem;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: rgba(5, 8, 16, 0.98);
        color: var(--muted);
        font-size: 0.8rem;
        font-weight: 600;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.25rem;
        transition: all 0.16s ease-out;
      }

      .action-btn.selected {
        border-color: var(--accent);
        background: var(--accent-soft);
        color: var(--accent);
        box-shadow: 0 0 0 1px rgba(39, 201, 168, 0.28);
      }

      .action-btn.disabled {
        opacity: 0.45;
        cursor: not-allowed;
        border-style: dashed;
      }

      .primary-btn {
        position: relative;
        overflow: hidden;
        margin-top: 0.5rem;
        width: 100%;
        padding: 0.6rem 0.9rem;
        border-radius: 999px;
        border: none;
        background: linear-gradient(135deg, var(--accent), #58d1ff);
        color: #05060a;
        font-size: 0.9rem;
        font-weight: 700;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        cursor: pointer;
        box-shadow: 0 10px 24px rgba(39, 201, 168, 0.4);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.35rem;
        transition:
          transform 0.08s ease-out,
          box-shadow 0.08s ease-out,
          filter 0.08s ease-out;
      }

      .primary-btn:active {
        transform: translateY(1px);
        box-shadow: 0 6px 18px rgba(39, 201, 168, 0.35);
        filter: brightness(0.97);
      }

      .primary-btn.disabled {
        cursor: default;
        pointer-events: none;
        opacity: 1;
        filter: none;
        box-shadow: 0 10px 24px rgba(39, 201, 168, 0.4);
      }

      .primary-btn .primary-progress {
        position: absolute;
        inset: 0;
        width: 0%;
        background: linear-gradient(90deg, rgba(235, 238, 243, 0.92), rgba(124, 132, 144, 0.94));
        box-shadow:
          inset 0 0 0 1px rgba(255, 255, 255, 0.08),
          inset 3px 0 22px rgba(5, 6, 10, 0.5);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.18s ease-out;
        z-index: 0;
        background: linear-gradient(90deg, rgba(18, 21, 30, 0.92), rgba(78, 86, 103, 0.94));
        box-shadow:
          inset 0 0 0 1px rgba(255, 255, 255, 0.08),
          inset 2px 0 12px rgba(0, 0, 0, 0.4);
        opacity: 0;
        transition: width 0.05s linear, opacity 0.14s ease-out;
        pointer-events: none;
        z-index: 0;
        background: linear-gradient(90deg, rgba(22, 25, 33, 0.92), rgba(44, 48, 60, 0.9));
        box-shadow:
          inset 0 0 0 1px rgba(255, 255, 255, 0.06),
          inset 2px 0 12px rgba(0, 0, 0, 0.35);
        opacity: 0;
        transition: width 0.04s linear, opacity 0.12s ease-out;
        pointer-events: none;
      }

      .primary-btn.timer-active .primary-progress {
        opacity: 1;
        animation: primaryFill 2s linear forwards;
      }

      @keyframes primaryFill {
        from {
          width: 0%;
        }
        to {
          width: 100%;
        }
      }

      .primary-btn.timer-active {
        opacity: 1;
        filter: none;
        box-shadow: 0 12px 26px rgba(39, 201, 168, 0.38);
      }

      .primary-btn .primary-content {
        position: relative;
        z-index: 1;
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
      }

      .primary-btn .primary-progress {
        position: absolute;
        inset: 0;
        width: 0%;
        background: linear-gradient(90deg, rgba(22, 25, 33, 0.92), rgba(44, 48, 60, 0.9));
        box-shadow:
          inset 0 0 0 1px rgba(255, 255, 255, 0.06),
          inset 2px 0 12px rgba(0, 0, 0, 0.35);
        background: linear-gradient(120deg, rgba(39, 201, 168, 0.3), rgba(88, 209, 255, 0.32));
        box-shadow:
          inset 0 0 0 1px rgba(39, 201, 168, 0.2),
          0 0 24px rgba(39, 201, 168, 0.35);
        opacity: 0;
        transition: width 0.04s linear, opacity 0.12s ease-out;
        pointer-events: none;
      }

      .primary-btn.timer-active .primary-progress {
        opacity: 1;
        background: linear-gradient(90deg, rgba(26, 30, 40, 0.94), rgba(105, 115, 136, 0.96));
      }

      .primary-btn.timer-active {
        opacity: 1;
        filter: none;
        box-shadow: 0 12px 26px rgba(39, 201, 168, 0.38);
      }

      .primary-btn .primary-content {
        position: relative;
        z-index: 1;
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
      }

      .ghost-btn {
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(4, 6, 12, 0.8);
        color: var(--muted);
        font-size: 0.78rem;
        padding: 0.3rem 0.75rem;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 0.3rem;
        text-transform: uppercase;
        letter-spacing: 0.11em;
        font-weight: 600;
        transition: all 0.16s ease-out;
      }

      .ghost-btn:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      .result {
        margin-top: 0.8rem;
        padding: 0.65rem 0.75rem;
        border-radius: 14px;
        background: rgba(5, 9, 20, 0.95);
        border: 1px solid rgba(255, 255, 255, 0.06);
        display: grid;
        gap: 0.4rem;
      }

      .grade-pill {
        display: inline-flex;
        align-items: baseline;
        gap: 0.4rem;
      }

      .grade-letter {
        font-size: 1.4rem;
        font-weight: 800;
        letter-spacing: 0.06em;
      }

      .grade-context {
        font-size: 0.8rem;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.12em;
      }

      .grade-badge-good {
        color: var(--accent);
      }

      .grade-badge-bad {
        color: var(--danger);
      }

      .recommendation {
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      .explanation {
        font-size: 0.9rem;
        color: var(--muted);
        line-height: 1.45;
      }

      .meta {
        display: flex;
        flex-wrap: wrap;
        gap: 0.4rem;
        margin-top: 0.2rem;
      }

      .meta span {
        font-size: 0.75rem;
        padding: 0.16rem 0.5rem;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        color: var(--muted);
      }

      .stats-card {
        margin-top: 0.7rem;
        padding: 0.6rem 0.75rem;
        border-radius: 14px;
        background: rgba(4, 8, 16, 0.9);
        border: 1px solid rgba(255, 255, 255, 0.06);
        display: grid;
        gap: 0.45rem;
      }

      .stats-row {
        display: flex;
        flex-wrap: wrap;
        gap: 0.4rem;
        align-items: center;
        justify-content: space-between;
      }

      .stat-group {
        display: flex;
        flex-wrap: wrap;
        gap: 0.4rem;
      }

      .stat-chip {
        font-size: 0.75rem;
        padding: 0.18rem 0.55rem;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid rgba(255, 255, 255, 0.06);
        color: var(--muted);
      }

      .report-card {
        display: inline-flex;
        align-items: center;
        gap: 0.65rem;
        padding: 0.5rem 1.2rem;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid rgba(255, 255, 255, 0.06);
        transform: scale(1.05);
      }

      .report-grade {
        font-size: 1.4rem;
        font-weight: 800;
        padding: 0.15rem 0.55rem;
        border-radius: 14px;
        background: rgba(39, 201, 168, 0.12);
        border: 1px solid rgba(39, 201, 168, 0.35);
      }

      .report-text {
        font-size: 0.95rem;
        color: var(--muted);
        line-height: 1.35;
      }

      .report-percent {
        margin-left: 0.35rem;
        font-size: 0.95rem;
        color: var(--accent);
        font-weight: 700;
      }

      .stat-chip.good {
        background: rgba(39, 201, 168, 0.12);
        border-color: rgba(39, 201, 168, 0.45);
        color: var(--accent);
      }

      .stat-chip.leaky {
        background: rgba(255, 83, 112, 0.08);
        border-color: rgba(255, 83, 112, 0.4);
        color: var(--danger);
      }

      .two-col {
        display: grid;
        gap: 0.8rem;
      }

      @media (min-width: 640px) {
        .two-col {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }

      .muted-note {
        font-size: 0.8rem;
        color: var(--muted);
        margin-top: 0.4rem;
      }

      .small-note {
        font-size: 0.76rem;
        color: var(--muted);
        opacity: 0.8;
      }

      .about-text {
        font-size: 0.9rem;
        color: var(--muted);
        line-height: 1.45;
      }

      .about-text strong {
        color: var(--text);
      }

      footer {
        margin-top: 1.4rem;
        font-size: 0.75rem;
        color: var(--muted);
        text-align: center;
        opacity: 0.7;
      }

      /* Scenario strip & cards */
      .scenario-pill {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.22rem 0.7rem;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.08);
        font-size: 0.78rem;
        text-transform: uppercase;
        letter-spacing: 0.11em;
        color: var(--muted);
      }

      .scenario-pill strong {
        color: var(--text);
        letter-spacing: 0.06em;
      }

      .card-strip {
        margin-top: 0.25rem;
        display: flex;
        gap: 0.6rem;
        align-items: center;
      }

      .poker-card {
        width: 62px;
        height: 88px;
        border-radius: 14px;
        background:
          radial-gradient(circle at 15% 10%, rgba(255, 255, 255, 0.24), transparent 55%),
          radial-gradient(circle at 85% 90%, rgba(88, 209, 255, 0.16), transparent 55%),
          var(--card-bg);
        border: 1px solid rgba(255, 255, 255, 0.28);
        box-shadow:
          0 0 18px rgba(39, 201, 168, 0.24),
          0 10px 24px rgba(0, 0, 0, 0.75);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        position: relative;
      }

      .poker-card::before {
        content: "";
        position: absolute;
        inset: 1px;
        border-radius: 13px;
        border: 1px solid rgba(0, 0, 0, 0.55);
        pointer-events: none;
      }

      .poker-rank {
        font-size: 1.5rem;
        font-weight: 700;
        letter-spacing: 0.06em;
        margin-bottom: 0.15rem;
      }

      .poker-suit {
        font-size: 1.2rem;
      }

      .poker-suit.red {
        color: #ff6b8b;
      }

      .card-row-info {
        display: flex;
        flex-direction: column;
        gap: 0.3rem;
      }

      .auto-deal {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
      }

      .auto-toggle {
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(4, 6, 12, 0.8);
        color: var(--muted);
        font-size: 0.78rem;
        padding: 0.2rem 0.9rem;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 0.3rem;
        text-transform: uppercase;
        letter-spacing: 0.11em;
        font-weight: 600;
        transition: all 0.16s ease-out;
      }

      .auto-toggle.active {
        border-color: var(--accent);
        color: var(--accent);
        background: var(--accent-soft);
      }

    </style>
  </head>
  <body>
    <div class="app-shell">
      <header>
        <div class="brand">
          <div class="logo">PM</div>
          <div>
            <div class="brand-title">Poker Training</div>
            <div class="brand-name">Poker My Mind</div>
            <div class="tagline">Judge your decisions, not your luck.</div>
          </div>
        </div>
        <nav class="nav">
          <button data-tab="preflop" class="active">Preflop Trainer</button>
          <button data-tab="potodds">Pot Odds</button>
          <button data-tab="about">About</button>
        </nav>
      </header>

      <main>
        <!-- Preflop Trainer -->
        <section id="tab-preflop" class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Preflop Trainer</div>
              <div class="card-subtitle">
                Get dropped into a random spot, choose your move, and see if it was a good decision – before any flop.
              </div>
            </div>
            <span class="pill">Random scenario · Unopened pot</span>
          </div>

          <div class="preflop-layout">
            <!-- 2. PREFLOP-SCENARIO-BAR -->
            <div class="preflop-scenario-bar">
              <div class="scenario-main">
                <div class="scenario-row">
                  <span class="scenario-label">Scenario</span>
                  <div class="scenario-pill" id="scenarioPosition">
                    POS: <strong>SB (Small Blind)</strong>
                  </div>
                </div>
                <div class="scenario-note small-note">
                  Unopened cash-game pot. Blinds posted, action is on you preflop.
                </div>
              </div>
              <div class="scenario-controls">
                <span class="small-note">Auto deal if A</span>
                <button
                  type="button"
                  class="auto-toggle"
                  id="autoDealToggle"
                  aria-pressed="true"
                >
                  On
                </button>
              </div>
            </div>

            <!-- 3 + 4. PREFLOP-DEALT-CARDS & PREFLOP-POSITION-INFO -->
            <div class="preflop-top">
              <div class="preflop-dealt-cards">
                <div class="section-label">Dealt cards</div>
                <div class="card-strip">
                  <div class="poker-card" id="card1">
                    <div class="poker-rank" id="card1Rank">A</div>
                    <div class="poker-suit" id="card1Suit">♠</div>
                  </div>
                  <div class="poker-card" id="card2">
                    <div class="poker-rank" id="card2Rank">J</div>
                    <div class="poker-suit red" id="card2Suit">♥</div>
                  </div>
                  <div class="card-row-info">
                    <div class="hand-preview" id="handPreview">
                      <span>Hand</span>
                      <strong>AJ</strong>
                    </div>
                    <div class="small-note">
                      Cards glow, you decide: fold, check, limp, or open-raise.
                    </div>
                  </div>
                </div>
              </div>

              <div class="preflop-position-info">
                <div class="section-label">Your position</div>
                <div class="position-panel">
                  <div class="position-map" aria-label="Table positions">
                    <div class="position-seat" data-pos="UTG">1. UTG</div>
                    <div class="position-seat" data-pos="MP">2. MP</div>
                    <div class="position-seat" data-pos="CO">3. CO</div>
                    <div class="position-seat" data-pos="BTN">4. BTN</div>
                    <div class="position-seat" data-pos="SB">5. SB</div>
                    <div class="position-seat" data-pos="BB">6. BB</div>
                  </div>
                  <p class="position-note small-note" id="positionNote">
                    SB (Small Blind): you act first after the flop, so play tighter and prefer strong or playable hands.
                  </p>
                </div>
              </div>
            </div>

            <!-- 5. PREFLOP-ACTIONS -->
            <div class="preflop-actions">
              <div class="section-label">Your action</div>
              <div class="actions-row" id="actionButtons">
                <button type="button" class="action-btn" data-action="FOLD">Fold</button>
                <button
                  type="button"
                  class="action-btn"
                  data-action="CHECK"
                  id="checkBtn"
                  style="display: none"
                >
                  Check
                </button>
                <button
                  type="button"
                  class="action-btn"
                  data-action="CALL"
                  id="callBtn"
                  title="Limping = calling the big blind preflop instead of raising. In the BB with no raise, you check instead of calling."
                >
                  Call / Limp
                </button>
                <button type="button" class="action-btn" data-action="RAISE">Raise / Open</button>
              </div>
            </div>

            <!-- 6 + 7. PREFLOP-PRIMARY-BUTTON & AUTO-DEAL TIMER -->
            <div class="preflop-primary">
              <button class="primary-btn" id="primaryBtn">
                <span class="primary-progress" id="autoDealBar"></span>
                <span class="primary-content">
                  <span id="primaryLabel">Deal new hand</span>
                  <span aria-hidden="true" id="primaryIcon">♠</span>
                </span>
              </button>
            </div>

            <!-- 8 + 9. PREFLOP-FEEDBACK & PREFLOP-STATS -->
            <div class="preflop-feedback">
              <div class="result" id="resultBox">
                <div class="grade-pill">
                  <span class="grade-letter grade-badge-good" id="gradeLetter">A</span>
                  <span class="grade-context" id="gradeContext">Good discipline.</span>
                </div>
                <div class="recommendation" id="recommendation">
                  Recommended: Folding is correct.
                </div>
                <p class="explanation" id="explanation">
                  Lock in an action for this hand to get a recommendation and grade.
                </p>
                <div class="meta" id="metaInfo">
                  <span>Spot: Unopened pot</span>
                  <span>Model: Simple cash-game open ranges</span>
                </div>
              </div>

              <div class="stats-card" aria-label="Session status">
                <div class="stats-row" id="statsRow">
                  <div class="stat-group">
                    <span class="stat-chip" id="statTotal">Decisions: 0</span>
                    <span class="stat-chip good" id="statGood">Good (A/B): 0</span>
                    <span class="stat-chip leaky" id="statLeaky">Leaky (C–F): 0</span>
                  </div>
                  <div class="report-card" aria-label="Overall report card">
                    <span class="report-grade" id="reportGrade">A</span>
                    <span class="report-text">
                      Overall grade
                      <span class="report-percent" id="reportPercent">100%</span>
                    </span>
                  </div>
                  <button type="button" class="ghost-btn" id="resetStatsBtn">
                    Reset stats
                  </button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Pot Odds -->
        <section id="tab-potodds" class="card" style="display: none">
          <div class="card-header">
            <div>
              <div class="card-title">Pot Odds Helper</div>
              <div class="card-subtitle">
                Quick math to check if a call with a draw makes sense.
              </div>
            </div>
            <span class="pill">Math · Single-street</span>
          </div>

          <div class="two-col">
            <div class="form-grid">
              <div class="field-group">
                <label for="potSize">Pot size before villain bets</label>
                <input
                  type="number"
                  id="potSize"
                  min="0"
                  step="0.01"
                  placeholder="e.g. 10"
                />
              </div>
              <div class="field-group">
                <label for="betSize">Bet you’re facing</label>
                <input
                  type="number"
                  id="betSize"
                  min="0"
                  step="0.01"
                  placeholder="e.g. 5"
                />
              </div>
              <div class="field-group">
                <label for="outs">Your number of outs</label>
                <input
                  type="number"
                  id="outs"
                  min="0"
                  max="20"
                  step="1"
                  placeholder="e.g. 9 for a flush draw"
                />
              </div>
              <button class="primary-btn" id="calculateOddsBtn">
                Calculate Pot Odds
                <span>≈</span>
              </button>
            </div>
            <div>
              <div class="result" id="oddsResultBox">
                <div class="grade-pill">
                  <span class="grade-letter" id="oddsSummary">–</span>
                  <span class="grade-context">Pot odds vs draw odds</span>
                </div>
                <div class="explanation" id="oddsExplanation">
                  Enter the pot size, bet size you’re facing, and your approximate outs. You’ll see:
                  <ul
                    style="
                      margin: 0.4rem 0 0 1.1rem;
                      padding: 0;
                      font-size: 0.85rem;
                    "
                  >
                    <li>Pot odds (% you need to break even)</li>
                    <li>Approximate equity from your outs</li>
                    <li>Whether a call is roughly +EV or -EV</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <p class="muted-note">
            Note: This is a simple one-street estimate. Real hands require implied odds, reverse implied odds, and
            ranges, but this keeps your baseline math honest.
          </p>
        </section>

        <!-- About -->
        <section id="tab-about" class="card" style="display: none">
          <div class="card-header">
            <div>
              <div class="card-title">About Poker My Mind</div>
              <div class="card-subtitle">
                A proof-of-concept trainer focused on decision quality over short-term results.
              </div>
            </div>
            <span class="pill">Prototype · v0.5</span>
          </div>
          <div class="about-text">
            <p>
              <strong>Poker My Mind</strong> is built around one core idea: you should judge your poker by the quality
              of your decisions, not by the luck of the runout.
            </p>
            <p>
              This proof of concept deals you <strong>random preflop scenarios</strong> in unopened pots: you get a
              position and a starting hand, you pick your move, and the app grades your decision against baseline
              opening ranges.
            </p>
            <p>
              In the big blind, you see a dedicated <strong>Check</strong> option and a disabled
              <strong>Call/Limp</strong> button to reinforce the idea that you don’t call in an unopened pot – you
              check.
            </p>
            <p>
              Each scenario can only be <strong>evaluated once</strong>. After you lock in a decision and see the
              grade, you must deal a new hand to get another rep. No spamming Evaluate to brute-force the right answer.
            </p>
            <p>
              It also includes a simple <strong>pot odds helper</strong> for draw math. Future iterations can layer in:
            </p>
            <ul>
              <li>Facing opens and 3-bets with range-based responses</li>
              <li>Postflop c-betting and call/fold decisions with equity estimates</li>
              <li>Full hand review with street-by-street grading and leak analysis</li>
            </ul>
          </div>
        </section>
      </main>

      <footer>
        Poker My Mind · Prototype trainer – not a real-time assistance tool for any specific poker site or casino.
        Always follow the rules of your cardroom.
      </footer>
    </div>

    <script>
      // ---------- Tabs ----------
      const tabs = document.querySelectorAll(".nav button");
      const sections = {
        preflop: document.getElementById("tab-preflop"),
        potodds: document.getElementById("tab-potodds"),
        about: document.getElementById("tab-about"),
      };

      tabs.forEach((btn) => {
        btn.addEventListener("click", () => {
          tabs.forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          const tab = btn.dataset.tab;
          Object.entries(sections).forEach(([key, el]) => {
            el.style.display = key === tab ? "block" : "none";
          });
        });
      });

      // ---------- Preflop logic ----------
      const rankOrder = ["A", "K", "Q", "J", "T", "9", "8", "7", "6", "5", "4", "3", "2"];
      const openRangesByPosition = {
        UTG: ["AA", "KK", "QQ", "JJ", "TT", "99", "AKs", "AQs", "AJs", "KQs", "AKo", "AQo"],
        MP: [
          "AA",
          "KK",
          "QQ",
          "JJ",
          "TT",
          "99",
          "88",
          "77",
          "AKs",
          "AQs",
          "AJs",
          "ATs",
          "KQs",
          "KJs",
          "QJs",
          "AKo",
          "AQo",
          "KQo",
        ],
        CO: [
          "AA",
          "KK",
          "QQ",
          "JJ",
          "TT",
          "99",
          "88",
          "77",
          "66",
          "55",
          "44",
          "33",
          "22",
          "AKs",
          "AQs",
          "AJs",
          "ATs",
          "A9s",
          "A8s",
          "KQs",
          "KJs",
          "KTs",
          "QJs",
          "QTs",
          "JTs",
          "T9s",
          "98s",
          "AKo",
          "AQo",
          "AJo",
          "KQo",
          "KJo",
          "QJo",
        ],
        BTN: [
          "AA",
          "KK",
          "QQ",
          "JJ",
          "TT",
          "99",
          "88",
          "77",
          "66",
          "55",
          "44",
          "33",
          "22",
          "AKs",
          "AQs",
          "AJs",
          "ATs",
          "A9s",
          "A8s",
          "A7s",
          "A6s",
          "A5s",
          "A4s",
          "A3s",
          "A2s",
          "KQs",
          "KJs",
          "KTs",
          "K9s",
          "QJs",
          "QTs",
          "Q9s",
          "JTs",
          "J9s",
          "T9s",
          "T8s",
          "98s",
          "97s",
          "87s",
          "76s",
          "65s",
          "AKo",
          "AQo",
          "AJo",
          "ATo",
          "A9o",
          "KQo",
          "KJo",
          "KTo",
          "QJo",
          "QTo",
          "JTo",
        ],
        SB: [
          "AA",
          "KK",
          "QQ",
          "JJ",
          "TT",
          "99",
          "88",
          "77",
          "66",
          "55",
          "AKs",
          "AQs",
          "AJs",
          "ATs",
          "A9s",
          "A8s",
          "KQs",
          "KJs",
          "KTs",
          "QJs",
          "QTs",
          "JTs",
          "T9s",
          "98s",
          "AKo",
          "AQo",
          "AJo",
          "KQo",
          "KJo",
          "QJo",
        ],
        BB: [
          "AA",
          "KK",
          "QQ",
          "JJ",
          "TT",
          "99",
          "88",
          "77",
          "AKs",
          "AQs",
          "AJs",
          "ATs",
          "KQs",
          "KJs",
          "QJs",
          "JTs",
          "T9s",
          "AKo",
          "AQo",
          "AJo",
          "KQo",
        ],
      };

      function canonicalHand(rank1, rank2, suitedFlag) {
        if (rank1 === rank2) {
          return rank1 + rank2;
        }
        const idx1 = rankOrder.indexOf(rank1);
        const idx2 = rankOrder.indexOf(rank2);
        const high = idx1 <= idx2 ? rank1 : rank2;
        const low = idx1 <= idx2 ? rank2 : rank1;
        return `${high}${low}${suitedFlag}`;
      }

      function evaluatePreflopOpen(position, hand, userAction) {
        const allowed = openRangesByPosition[position] || [];
        const isInOpenRange = allowed.includes(hand);

        // Special handling for big blind check/fold/raise
        if (position === "BB") {
          if (userAction === "CHECK") {
            if (isInOpenRange) {
              return {
                grade: "B",
                good: true,
                context: "Safe but passive.",
                recommended: "Raising prints more value.",
                explanation: `Checking ${hand} in the big blind is never terrible when you get a free flop, but raising strong hands here builds a pot when you are ahead.`,
              };
            } else {
              return {
                grade: "A",
                good: true,
                context: "Correct free check.",
                recommended: "Checking is ideal.",
                explanation: `With ${hand} in the big blind and no raise, checking to see a free flop is the highest-EV default. You realize your equity without risking chips preflop.`,
              };
            }
          }
          if (userAction === "FOLD") {
            return {
              grade: "D",
              good: false,
              context: "Too tight.",
              recommended: "Check instead of folding.",
              explanation: `Folding in the big blind when you can check for free throws away equity. Use the check option to see a flop instead of mucking.`,
            };
          }
          // For raises in BB, fall through to regular open-range logic below
        }

        if (isInOpenRange) {
          if (userAction === "RAISE") {
            return {
              grade: "A",
              good: true,
              context: "Solid open.",
              recommended: "Raise / open this hand.",
              explanation: `${hand} is in your recommended open range from ${position}. Opening here applies pressure and prints value long term.`,
            };
          }
          if (userAction === "FOLD") {
            return {
              grade: "F",
              good: false,
              context: "Too tight.",
              recommended: "Raise this hand instead of folding.",
              explanation: `Folding ${hand} from ${position} is leaving money on the table. This hand should be opened in most lineups.`,
            };
          }
          if (userAction === "CALL") {
            return {
              grade: "C",
              good: false,
              context: "Leaky limp.",
              recommended: "Raise, don't limp.",
              explanation: `Limping ${hand} from ${position} is usually dominated and hard to play. Raising is higher EV and keeps your range aggressive.`,
            };
          }
        } else {
          if (userAction === "RAISE") {
            return {
              grade: "D",
              good: false,
              context: "Too loose.",
              recommended: "Fold this hand preflop.",
              explanation: `${hand} is outside the recommended open range from ${position}. Opening hands like this loses money over time.`,
            };
          }
          if (userAction === "CALL") {
            return {
              grade: "D",
              good: false,
              context: "Weak limp.",
              recommended: "Just fold this hand.",
              explanation: `Calling or limping ${hand} here is rarely profitable. In an unopened pot, you want to raise strong hands and fold the rest.`,
            };
          }
          if (userAction === "FOLD") {
            return {
              grade: "A",
              good: true,
              context: "Good discipline.",
              recommended: "Folding is correct.",
              explanation: `${hand} is not in your profitable open range from ${position}. Folding keeps your range tight and avoids marginal spots.`,
            };
          }
        }

        return {
          grade: "B",
          good: true,
          context: "Reasonable.",
          recommended: "Borderline, but not terrible.",
          explanation: `This is a borderline spot for ${hand} from ${position}. Against tighter fields, folding is fine; against weak players, opening may be okay.`,
        };
      }

      // Scenario dealing
      const positions = ["UTG", "MP", "CO", "BTN", "SB", "BB"];
      const positionLabels = {
        UTG: "1. UTG (Early)",
        MP: "2. MP (Middle)",
        CO: "3. CO (Cutoff)",
        BTN: "4. BTN (Button)",
        SB: "5. SB (Small Blind)",
        BB: "6. BB (Big Blind)",
      };

      const positionDescriptions = {
        UTG: "Early position: many players left to act. Play your tightest range here.",
        MP: "Middle position: a bit safer than UTG, but still tighten up compared to late seats.",
        CO: "Cutoff: late position with only the button behind. You can open wider and steal more.",
        BTN: "Button: best seat at the table. You act last postflop, so you can play the widest range.",
        SB: "Small blind: you are out of position postflop and already invested. Open tighter and avoid junk.",
        BB: "Big blind: you close the action preflop and often get to defend with good odds.",
      };

      const ranks = ["A", "K", "Q", "J", "T", "9", "8", "7", "6", "5", "4", "3", "2"];
      const suits = [
        { symbol: "♠", color: "black" },
        { symbol: "♥", color: "red" },
        { symbol: "♦", color: "red" },
        { symbol: "♣", color: "black" },
      ];

      const scenarioPositionEl = document.getElementById("scenarioPosition");
      const positionNoteEl = document.getElementById("positionNote");
      const positionSeats = document.querySelectorAll(".position-seat");

      const handPreviewEl = document.getElementById("handPreview").querySelector("strong");
      const card1RankEl = document.getElementById("card1Rank");
      const card1SuitEl = document.getElementById("card1Suit");
      const card2RankEl = document.getElementById("card2Rank");
      const card2SuitEl = document.getElementById("card2Suit");

      const actionButtonsEl = document.getElementById("actionButtons");
      const callBtn = document.getElementById("callBtn");
      const checkBtn = document.getElementById("checkBtn");
      const primaryBtn = document.getElementById("primaryBtn");
      const primaryLabelEl = document.getElementById("primaryLabel");
      const primaryIconEl = document.getElementById("primaryIcon");
      const autoDealToggle = document.getElementById("autoDealToggle");
      const autoDealBarEl = document.getElementById("autoDealBar");

      const gradeLetterEl = document.getElementById("gradeLetter");
      const gradeContextEl = document.getElementById("gradeContext");
      const recommendationEl = document.getElementById("recommendation");
      const explanationEl = document.getElementById("explanation");

      let currentPosition = "BTN";
      let currentCanonicalHand = "AA";
      let selectedAction = null;
      let hasEvaluatedCurrent = false;
      let autoDealEnabled = true;
      let awaitingManualDeal = false;
      let autoDealTimeoutId = null;
      let lastEvalGrade = null;

      function randomFrom(arr) {
        return arr[Math.floor(Math.random() * arr.length)];
      }

      function applyActionSelection(action) {
        selectedAction = action;
        if (!actionButtonsEl) return;
        actionButtonsEl.querySelectorAll(".action-btn").forEach((b) => {
          b.classList.toggle("selected", b.dataset.action === selectedAction);
        });
      }

      function updatePositionDisplay() {
        if (!positionNoteEl || !positionSeats) return;
        const label = positionLabels[currentPosition] || currentPosition;
        scenarioPositionEl.innerHTML = `POS: <strong>${label}</strong>`;

        // Highlight active seat
        positionSeats.forEach((seat) => {
          const seatPos = seat.getAttribute("data-pos");
          seat.classList.toggle("active", seatPos === currentPosition);
        });

        // Update short description
        const desc = positionDescriptions[currentPosition];
        if (desc) {
          positionNoteEl.textContent = desc;
        }
      }

      function updateActionsForPosition() {
        if (!callBtn || !checkBtn) return;
        const allActionBtns = actionButtonsEl.querySelectorAll(".action-btn");

        if (currentPosition === "BB") {
          // Show Check, disable Call/Limp
          checkBtn.style.display = "flex";
          callBtn.classList.add("disabled");
          callBtn.setAttribute("aria-disabled", "true");
          callBtn.title = "In the big blind with no raise, you don't call – checking is free.";
        } else {
          checkBtn.style.display = "none";
          callBtn.classList.remove("disabled");
          callBtn.removeAttribute("aria-disabled");
          callBtn.title = "Limping = calling the big blind preflop instead of raising.";

          // If we were on CHECK before and moved off BB, clear selection
          if (selectedAction === "CHECK") {
            applyActionSelection(null);
          }
        }

        // Ensure selected visual state matches selectedAction
        allActionBtns.forEach((b) => {
          b.classList.toggle("selected", b.dataset.action === selectedAction);
        });
      }

      function setDefaultActionForPosition() {
        const defaultAction = currentPosition === "BB" ? "CHECK" : "FOLD";
        const targetBtn =
          defaultAction === "CHECK"
            ? checkBtn
            : actionButtonsEl.querySelector('.action-btn[data-action="FOLD"]');

        if (
          targetBtn &&
          !targetBtn.classList.contains("disabled") &&
          targetBtn.getAttribute("aria-disabled") !== "true"
        ) {
          applyActionSelection(defaultAction);
        }
      }

      function updateAutoDealToggleUI() {
        if (!autoDealToggle) return;
        autoDealToggle.setAttribute("aria-pressed", autoDealEnabled ? "true" : "false");
        autoDealToggle.classList.toggle("active", autoDealEnabled);
        autoDealToggle.textContent = autoDealEnabled ? "On" : "Off";
      }

      function clearAutoDealTimer() {
        if (autoDealTimeoutId !== null) {
          clearTimeout(autoDealTimeoutId);
          autoDealTimeoutId = null;
        }
        if (autoDealBarEl) {
          autoDealBarEl.style.animation = "none";
          autoDealBarEl.style.width = "0%";
        }
        primaryBtn.classList.remove("timer-active");
      }

      function setPrimaryBtnToEvaluate() {
        primaryLabelEl.textContent = "Evaluate Decision";
        primaryIconEl.textContent = "→";
      }

      function setPrimaryBtnToDeal() {
        primaryLabelEl.textContent = "Deal new hand";
        primaryIconEl.textContent = "♠";
      }

      function resetResultBox() {
        gradeLetterEl.textContent = "–";
        gradeLetterEl.classList.remove("grade-badge-good", "grade-badge-bad");
        gradeContextEl.textContent = "Awaiting decision.";
        recommendationEl.textContent = "Pick an action and evaluate to see feedback.";
        explanationEl.textContent = "Lock in an action for this hand to get a recommendation and grade.";
      }

      function resetEvaluateState() {
        hasEvaluatedCurrent = false;
        awaitingManualDeal = false;
        lastEvalGrade = null;
        clearAutoDealTimer();
        setPrimaryBtnToEvaluate();
        primaryBtn.classList.remove("disabled");
        primaryBtn.removeAttribute("aria-disabled");
        primaryBtn.disabled = false;
      }

      function dealScenario() {
        // Random position
        currentPosition = randomFrom(positions);
        updatePositionDisplay();

        // Random distinct cards
        const r1 = randomFrom(ranks);
        const s1 = randomFrom(suits);
        let r2 = randomFrom(ranks);
        let s2 = randomFrom(suits);
        // Ensure not identical card
        while (r2 === r1 && s2.symbol === s1.symbol) {
          r2 = randomFrom(ranks);
          s2 = randomFrom(suits);
        }

        const suitedFlag = r1 === r2 ? "" : s1.symbol === s2.symbol ? "s" : "o";
        currentCanonicalHand = canonicalHand(r1, r2, suitedFlag || (s1.symbol === s2.symbol ? "s" : "o"));

        // Update visual cards
        card1RankEl.textContent = r1;
        card1SuitEl.textContent = s1.symbol;
        card1SuitEl.classList.toggle("red", s1.color === "red");

        card2RankEl.textContent = r2;
        card2SuitEl.textContent = s2.symbol;
        card2SuitEl.classList.toggle("red", s2.color === "red");

        handPreviewEl.textContent = currentCanonicalHand;

        // Clear selected action on new deal
        applyActionSelection(null);
        resetResultBox();
        resetEvaluateState();
        updateActionsForPosition();
        setDefaultActionForPosition();
      }

      actionButtonsEl.addEventListener("click", (e) => {
        const btn = e.target.closest(".action-btn");
        if (!btn) return;
        if (btn.classList.contains("disabled") || btn.getAttribute("aria-disabled") === "true") {
          // Ignore clicks on disabled buttons (e.g., Call/Limp in BB)
          return;
        }
        applyActionSelection(btn.dataset.action);
      });

      // Stats in localStorage
      const statsKey = "pokerMyMind_preflopStats";
      function loadStats() {
        try {
          const raw = localStorage.getItem(statsKey);
          if (!raw) return { total: 0, good: 0, leaky: 0 };
          return JSON.parse(raw);
        } catch {
          return { total: 0, good: 0, leaky: 0 };
        }
      }
      function saveStats(stats) {
        try {
          localStorage.setItem(statsKey, JSON.stringify(stats));
        } catch (e) {
          // ignore
        }
      }
      function updateStatsUI() {
        const stats = loadStats();
        document.getElementById("statTotal").textContent = `Decisions: ${stats.total}`;
        document.getElementById("statGood").textContent = `Good (A/B): ${stats.good}`;
        document.getElementById("statLeaky").textContent = `Leaky (C–F): ${stats.leaky}`;

        const reportGradeEl = document.getElementById("reportGrade");
        const reportPercentEl = document.getElementById("reportPercent");
        if (!reportGradeEl || !reportPercentEl || stats.total === 0) {
          reportGradeEl.textContent = "–";
          reportPercentEl.textContent = "0%";
          return;
        }
        const goodRate = stats.good / stats.total;
        let grade = "D";
        if (goodRate >= 0.9) grade = "A";
        else if (goodRate >= 0.75) grade = "B";
        else if (goodRate >= 0.6) grade = "C";
        else grade = "D";
        reportGradeEl.textContent = grade;
        reportPercentEl.textContent = `${Math.round(goodRate * 100)}%`;
      }
      updateStatsUI();

      document.getElementById("resetStatsBtn").addEventListener("click", () => {
        localStorage.removeItem(statsKey);
        updateStatsUI();
        resetResultBox();
      });

      function syncAutoDealToggle() {
        if (!autoDealToggle) return;
        autoDealToggle.setAttribute("aria-pressed", autoDealEnabled ? "true" : "false");
        autoDealToggle.classList.toggle("active", autoDealEnabled);
        autoDealToggle.textContent = autoDealEnabled ? "On" : "Off";
      }

      syncAutoDealToggle();

      if (autoDealToggle) {
        updateAutoDealToggleUI();
        autoDealToggle.addEventListener("click", () => {
          autoDealEnabled = !autoDealEnabled;
          updateAutoDealToggleUI();
          syncAutoDealToggle();
          if (!autoDealEnabled) {
            clearAutoDealTimer();
            if (hasEvaluatedCurrent && !awaitingManualDeal) {
              awaitingManualDeal = true;
              primaryBtn.classList.remove("disabled");
              primaryBtn.removeAttribute("aria-disabled");
              primaryBtn.disabled = false;
              setPrimaryBtnToDeal();
            }
          }
        });
      }

      function startAutoDealCountdown() {
        if (lastEvalGrade !== "A" || !autoDealEnabled) {
          return;
        }

        clearAutoDealTimer();
        if (!autoDealBarEl) {
          autoDealTimeoutId = setTimeout(() => {
            dealScenario();
            clearAutoDealTimer();
          }, 2000);
          return;
        }

        primaryBtn.classList.add("timer-active");
        autoDealBarEl.style.animation = "none";
        autoDealBarEl.style.width = "0%";
        // Force reflow so restarting animation works consistently
        void autoDealBarEl.offsetWidth;
        autoDealBarEl.style.animation = "primaryFill 2s linear forwards";

        const duration = 2000;
        const finishHoldMs = 140;
        autoDealTimeoutId = setTimeout(() => {
          if (autoDealEnabled && hasEvaluatedCurrent && lastEvalGrade === "A") {
            dealScenario();
            clearAutoDealTimer();
        primaryBtn.classList.add("timer-active");
        autoDealBarEl.style.width = "0%";
        const start = performance.now();
        const duration = 2000;
        const finishHoldMs = 140;

        function step(now) {
          const elapsed = now - start;
          const progress = Math.min(elapsed / duration, 1);
          autoDealBarEl.style.width = progress * 100 + "%";
          if (progress < 1 && autoDealEnabled && hasEvaluatedCurrent && lastEvalGrade === "A") {
            requestAnimationFrame(step);
          } else if (progress >= 1 && hasEvaluatedCurrent && autoDealEnabled && lastEvalGrade === "A") {
            autoDealBarEl.style.width = "100%";
            autoDealTimeoutId = setTimeout(() => {
              if (autoDealEnabled && hasEvaluatedCurrent && lastEvalGrade === "A") {
                dealScenario();
                clearAutoDealTimer();
              }
            }, finishHoldMs);
          }
        }, duration + finishHoldMs);
      }

      primaryBtn.addEventListener("click", () => {
        if (awaitingManualDeal) {
          // After a graded decision that requires manual progression, deal the next hand
          dealScenario();
          return;
        }

        if (hasEvaluatedCurrent) {
          // Already graded this spot; ignore until a new hand is dealt
          return;
        }

        if (!selectedAction) {
          // Require the user to actually pick an action before grading
          gradeLetterEl.textContent = "–";
          gradeLetterEl.classList.remove("grade-badge-good", "grade-badge-bad");
          gradeContextEl.textContent = "Pick an action first.";
          recommendationEl.textContent = "Choose Fold, Check, Call/Limp, or Raise before evaluating.";
          explanationEl.textContent =
            "Poker is about decisions. Lock in what you would actually do at the table, then hit Evaluate.";
          return;
        }

        const evalResult = evaluatePreflopOpen(currentPosition, currentCanonicalHand, selectedAction);
        gradeLetterEl.textContent = evalResult.grade;
        gradeLetterEl.classList.toggle("grade-badge-good", evalResult.good);
        gradeLetterEl.classList.toggle("grade-badge-bad", !evalResult.good);
        gradeContextEl.textContent = evalResult.context;
        recommendationEl.textContent = `Recommended: ${evalResult.recommended}`;
        explanationEl.textContent = evalResult.explanation;

        hasEvaluatedCurrent = true;
        lastEvalGrade = evalResult.grade;

        // Update stats
        const stats = loadStats();
        stats.total += 1;
        if (evalResult.grade === "A" || evalResult.grade === "B") {
          stats.good += 1;
        } else {
          stats.leaky += 1;
        }
        saveStats(stats);
        updateStatsUI();

        if (autoDealEnabled && evalResult.grade === "A") {
          // Lock the button and auto-deal on A grades
          primaryBtn.classList.add("disabled");
          primaryBtn.setAttribute("aria-disabled", "true");
          primaryBtn.disabled = true;
          setPrimaryBtnToEvaluate();
          startAutoDealCountdown();
        } else {
          // Manual mode: convert primary button into "Deal new hand"
          awaitingManualDeal = true;
          setPrimaryBtnToDeal();
        }
      });

      // ---------- Pot odds helper ----------
      function approximateEquityFromOuts(outs) {
        // Rough rule-of-thumb with one card to come
        return outs * 2.2;
      }

      document.getElementById("calculateOddsBtn").addEventListener("click", () => {
        const potSize = parseFloat(document.getElementById("potSize").value || "0");
        const betSize = parseFloat(document.getElementById("betSize").value || "0");
        const outs = parseInt(document.getElementById("outs").value || "0", 10);

        const summaryEl = document.getElementById("oddsSummary");
        const explanationElOdds = document.getElementById("oddsExplanation");

        if (betSize <= 0 || potSize < 0 || outs < 0) {
          summaryEl.textContent = "–";
          explanationElOdds.textContent =
            "Enter a pot size, a bet you are facing, and a non-negative number of outs to see the math.";
          return;
        }

        const totalPotIfCall = potSize + betSize + betSize;
        const potOdds = betSize / totalPotIfCall; // break-even frequency
        const equityNeededPct = potOdds * 100;
        const equityFromOutsPct = approximateEquityFromOuts(outs);

        const isProfitable = equityFromOutsPct >= equityNeededPct;
        const verdict = isProfitable ? "Calling is roughly +EV." : "Calling is roughly -EV, folding is safer.";

        summaryEl.textContent = isProfitable ? "Call OK" : "Fold";
        explanationElOdds.innerHTML =
          `Pot odds require about ${equityNeededPct.toFixed(1)}% equity. ` +
          `Your draw with ${outs} outs is worth roughly ${equityFromOutsPct.toFixed(1)}% equity.<br><br>` +
          verdict;
      });

      // Deal an initial scenario on load
      dealScenario();
    </script>
  </body>
</html>
